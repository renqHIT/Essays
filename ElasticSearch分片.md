# ElasticSearch分片

标签（空格分隔）： ElasticSearch 数据库 Shard

---

## 一、什么是Shard

索引可能存储大量数据，超过一个节点的硬件限制。例如，一个10亿级别文档的索引占用1TB磁盘空间，可能节点上的一块磁盘存不下，或者即使可以存储，但查询请求的响应变得太慢。为了解决这个问题，ElasticSearch提供了下面的功能，将划分索引成多个部分，叫做Shard。当你创建一个索引，你可以指定Shards的个数。每个Shard是独立的，功能完全的，可以在集群的任意节点存储。

为什么索引要分Shard存储呢? 有下面两个重要的原因：

 - 它可以让你水平切分数据，**扩展内容量**；
 - 它可以让你在多个Shard上分布式，并行地执行操作，**提高吞吐率**；

决定Shard如何分布的机制，以及文档是如何聚集成搜索请求的机制，这两点都是由ElasticSearch完全管理的，对用户来说是透明的。

## 二、备份 Replica
 
备份的作用，两个方面：

 - 如果节点或者Shard跪了，备份用来支持高可用，因为备份不会被分配在和主shard相同的节点上
 - 允许提升搜索量/吞吐率，因为搜索可以在所有备份上并行执行
 

总结下来，每个索引可以切分成多个Shards。一个索引可以备份0到多份。一旦备份了，每个索引将拥有主Shards和备份Shards。Shards和备份数量可以在创建索引时定义。一旦索引已经创建，你不能修改Shards的数量，但是可以修改备份数量。

默认情况，每个ElasticSearch的索引都分配5个主Shards，1个备份。也就是说，如果集群有两个或以上的节点，你的每个索引将会有5个主Shards和5个备份Shards。

Note：每个ElasticSearch shard就是一个Lucene索引。在一个Lucene索引中，存在一个最大文档个数。在Lucene中，这个数字是Integer.MAX_VALUE - 128。你可以通过这个API监控Shard大小: _cat/shards。
