# 以太坊白皮书

作者 Vitalik Buterin

## 摘要

当中本聪在2009年1月首次提出比特币区块链时，他同时引入了两个激进且未测试的概念。第一个是“比特币”，一个去中心、点对点的在线货币系统，没有人背书，没有内在价值，没有中心发行人。到目前为止，比特币作为数字货币已经引起了公众的大量注意，既在“没有中央银行的货币”的政治层面，也在其价格极度上下波动层面。然而中本聪的伟大实验，还有一个和比特币同等重要的方面：基于工作量证明的区块链概念，这个概念让公众在合约上达成一致。比特币作为一项应用，可以描述为一个first-to-file系统：如果一个实体拥有50个比特币，同时给A和B发送50个比特币, 只有首先得到确认的交易会执行。本质上没有办法判断哪个交易来的更早，这个问题长期以来一直困扰着去中心数字货币的开发。中本聪的区块链时第一个可信的去中心化解决方案。现在，人们开始将注意力转移到比特币技术的第二个方面，除了货币，我们还能应用区块链技术做什么。
一般应用包括用数字资产去做自定义货币（山寨币），做物理设备所有权证明（智能资产），不可替代资产（如域名）所有权证明，做去中心交易，金融衍生品，做点对点赌博，做区块链身份和征信系统。另一个重要探索领域是“智能合约”：一个按照预设规则自动转移数字资产的系统。例如，某人有一项财务合同“A每天可以提取最多X个货币单位，B每天可以提取最多Y个货币单位，A和B一起可以提取任意，A可以关闭B的提取权限”。这个去中心化自制组织的逻辑扩展，即长期智能合约，拥有资产并且制定整个组织的规则。以太坊（Ethereum）提供的是一个内置完整功能的，图灵完备的编程语言，它可以用来创建“编码任意状态转移函数的合约”，通过编写几行代码，以太坊即可支持用户创建上面提到的各种系统，以及其他未想到的系统。

## 历史

## 比特币：作为状态转移系统

传统的交易系统是一个状态转移系统，交易TX将系统状态S转移为状态S'

```
APPLY(S, TX) -> S' or ERROR
```

具体地，转账成功

```
APPLY({ Alice：$50, Bob: $50 }, "从Alice转账给Bob $20") = { Alice: $30, Bob: $70 }
```
转账失败

```
APPLY({ Alice: $30, Bob: $50}, "从Alice转账给Bob $70") = ERROR
```

在比特币中，**状态**是已经挖到但没有花掉的币的集合（技术上讲，是“未消费的交易输出”，UTXO），每个UTXO拥有一个面值和一个拥有者（定义为一个密码学公钥，20字节的地址）。一份交易包含一个或多个输入，每个输入包含一个指向一个存在的UTXO的引用，包含一个密码学签名(由拥有者地址关联的私钥产生)；一份交易还包括一个或多个输出，每个输出包含一个新的UTXO，等待加到状态中。**状态转移函数** APPLY(S,TX) -> S'可以粗略地定义为：

```
1. 对每个TX:
  i. 如果引用的UTXO不在S中，返回错误
  ii.如果提供的签名不匹配UTXO的拥有者，返回错误
2. 如果索引输入UTXO的面值之和小于输出的UTXO面值之和，返回错误
3. 返回状态S，所有输入的UTXO被删除，所有输出的UTXO被加上
```

第一步阻止交易发送方花费不存在的币，阻止交易发送方花费其他人的币；第二步保护面值。协议是这样工作的，假设Alice想要给Bob发送11.7个比特币，首先，Alice寻找她自己可用的UTXO的集合，面值之和不小于11.7个比特币。现实中，Alice不会得到正好11.7个比特币，假如她能得到最小的面值之和是6+4+2=12。**TODO：以下内容省略**

## 挖矿

如果我们能访问到一个可信赖的中央服务，实现上面的系统是没营养的，可以按照上面列举的步骤进行编码。然而在比特币中，我们要构建一个去中心的货币系统，因此我们需要将上面的状态转移系统和一个共识系统结合起来，确保所有人在交易顺序上达成一致。比特币的去中心共识过程需要网络中的节点持续地产生交易数据包，称作“区块”。网络倾向于每10分钟产生一个区块，每个区块包含一个时间戳，一个nonce（密码学中指只被使用一次的随机数），一个指向前一个区块的哈希指针，一个交易列表，包含从上个区块起发生的交易。随着时间进行，这个过程产生了一致的，持续增长的“区块链”，保持更新比特币账本的最新状态。

检查一个区块是否合法的算法如下：
```
1. 检查前一个区块是否存在，是否合法
2. 检查当前区块的时间戳是否大于前一个区块且小于未来两小时
3. 检查当前区块的工作量证明是否合法
4. 令S[0]是前一个区块结束时的状态
5. 设TX是当前区块的交易列表，包含n个交易。对每个i从0到n-1，令S[i+1] = APPLY(S[i], TX[i]), 如果任意一个交易返回错误，报错退出
6. 返回成功，令状态S[n]为当前区块结束时的状态
```



## Merkle树

## 以太坊

